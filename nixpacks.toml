[phases.setup]
aptPkgs = ["php8.2-mysql", "php8.2-pdo", "php8.2-pdo_mysql", "nodejs", "npm"]

[phases.build]
cmds = [
  "composer install --no-dev --optimize-autoloader --no-interaction",
  "npm install",
  "npm run build",
  "cp public/build/.vite/manifest.json public/build/manifest.json || true",
  "mkdir -p storage/framework/views storage/framework/cache/data storage/framework/sessions storage/logs bootstrap/cache",
  "chmod -R 775 storage bootstrap/cache || true",
  "php artisan config:clear || true",
  "php artisan route:clear || true",
  "php artisan view:clear || true",
  "php artisan cache:clear || true",
  "chmod +x start.sh"
]

[start]
cmd = "bash start.sh"
